id: io.github.ladaapp.lada
runtime: org.gnome.Platform
runtime-version: '47'
sdk: org.gnome.Sdk
command: lada
finish-args:
  - "--socket=wayland"
  - "--socket=fallback-x11"
  - "--device=dri"
  - "--share=ipc"
  - "--socket=pulseaudio"
  - "--env=LADA_MODEL_WEIGHTS_DIR=/app/model_weights"
  - "--env=YOLO_CONFIG_DIR=/var/config/yolo"
modules:
  - lada-pip-dependencies.json
  - name: lada
    buildsystem: simple
    build-commands:
      - |
        mkdir -p /app/model_weights/3rd_party
        mv lada_mosaic_restoration_model_generic_v1.2.pth /app/model_weights/
        mv lada_mosaic_detection_model_v3-yolo11n-seg-beta3.pt /app/model_weights/lada_mosaic_detection_model_v2.pt
        mv clean_youknow_video.pth /app/model_weights/3rd_party/
      - python3 -m pip install --prefix=/app --no-deps '.[basicvsrpp,gui]'
      - |
        install -d /app/share
        mv packaging/flatpak/share/* /app/share/
      - |
        patch -i $FLATPAK_BUILDER_BUILDDIR/patches/adjust_mmengine_resume_dataloader.patch -p2 -d /app
        patch -u $FLATPAK_BUILDER_BUILDDIR/patches/increase_mms_time_limit.patch -p2 -d /app
        patch -u $FLATPAK_BUILDER_BUILDDIR/patches/remove_ultralytics_telemetry.patch -p2 -d /app
    sources:
      - type: git
        url: "https://github.com/ladaapp/lada.git"
        commit: eecd6bf0c7fbc4fcf1054f88010f68b3b7c8012e
#        tag: v0.7.0-beta3
      - type: file
        url: "https://github.com/ladaapp/lada/releases/download/v0.7.0-beta3/lada_mosaic_detection_model_v3-yolo11n-seg-beta3.pt"
        sha256: 5707c3af78a13ef8d60d0c3a3ea420e79745ac5c9b7d792e3a13598fcdedfc8f
      - type: file
        url: "https://github.com/ladaapp/lada/releases/download/v0.6.0/lada_mosaic_restoration_model_generic_v1.2.pth"
        sha256: d404152576ce64fb5b2f315c03062709dac4f5f8548934866cd01c823c8104ee
      - type: file
        url: "https://drive.usercontent.google.com/download?id=1ulct4RhRxQp1v5xwEmUH7xz7AK42Oqlw&export=download&confirm=t"
        sha256: 5643ca297c13920b8ffd39a0d85296e494683a69e5e8204d662653d24c582766
        dest-filename: clean_youknow_video.pth
